generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String       @id @default(uuid())
  email          String       @unique
  passwordHash   String
  name           String
  role           Role
  grade          Int?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  attempts       Attempt[]
  teacherClasses Class[]      @relation("TeacherClasses")
  enrollments    Enrollment[]
  progress       Progress?
  badges         UserBadge[]

  @@index([email])
}

model Progress {
  id                 String   @id @default(uuid())
  userId             String   @unique
  totalPoints        Int      @default(0)
  currentStreak      Int      @default(0)
  longestStreak      Int      @default(0)
  exercisesCompleted Int      @default(0)
  correctAnswers     Int      @default(0)
  totalAnswers       Int      @default(0)
  lastActivity       DateTime @default(now())
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Exercise {
  id            String       @id @default(uuid())
  type          ExerciseType
  question      String
  options       String[]
  correctAnswer Int
  difficulty    Int          @default(1)
  explanation   String?
  tags          String[]
  createdAt     DateTime     @default(now())
  attempts      Attempt[]
}

model Attempt {
  id               String   @id @default(uuid())
  userId           String
  exerciseId       String
  selectedAnswer   Int
  isCorrect        Boolean
  timeSpentSeconds Int?
  createdAt        DateTime @default(now())
  exercise         Exercise @relation(fields: [exerciseId], references: [id])
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([exerciseId])
  @@index([createdAt])
}

model Badge {
  id               String      @id @default(uuid())
  name             String      @unique
  description      String
  icon             String
  requirementType  String
  requirementValue Int
  createdAt        DateTime    @default(now())
  userBadges       UserBadge[]
}

model UserBadge {
  id       String   @id @default(uuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())
  badge    Badge    @relation(fields: [badgeId], references: [id])
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
}

model Class {
  id          String       @id @default(uuid())
  name        String
  teacherId   String
  grade       Int
  year        Int
  createdAt   DateTime     @default(now())
  assignments Assignment[]
  teacher     User         @relation("TeacherClasses", fields: [teacherId], references: [id])
  enrollments Enrollment[]

  @@index([teacherId])
}

model Enrollment {
  id         String   @id @default(uuid())
  studentId  String
  classId    String
  enrolledAt DateTime @default(now())
  class      Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  student    User     @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, classId])
  @@index([studentId])
  @@index([classId])
}

model Assignment {
  id          String    @id @default(uuid())
  classId     String
  title       String
  description String?
  exerciseIds String[]
  dueDate     DateTime?
  createdAt   DateTime  @default(now())
  class       Class     @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@index([classId])
}

enum Role {
  STUDENT
  TEACHER
  PARENT
  ADMIN
}

enum ExerciseType {
  SYLLABLE
  RHYME
  BLEND
  SIGHT
  SUFFIX
}
